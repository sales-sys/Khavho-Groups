<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Test Page</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { color: green; }
        .error { color: red; }
        .pending { color: orange; }
        button { padding: 10px 20px; margin: 10px 0; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer; }
        #results { background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px; }
    </style>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
</head>
<body>
    <h1>üîÑ Admin Panel ‚Üî Website Integration Test</h1>
    
    <div class="test-section">
        <h3>Test 1: Firebase Connection</h3>
        <button onclick="testFirebaseConnection()">Test Firebase Connection</button>
        <div id="firebase-result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Load Products from Admin Panel</h3>
        <button onclick="testProductLoad()">Load Products</button>
        <div id="products-result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Add Sample Product</h3>
        <button onclick="addSampleProduct()">Add Sample Product</button>
        <div id="add-result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 4: Category Mapping</h3>
        <button onclick="testCategoryMapping()">Test Category Mapping</button>
        <div id="category-result"></div>
    </div>

    <script>
        async function testFirebaseConnection() {
            const result = document.getElementById('firebase-result');
            result.innerHTML = '<span class="pending">Testing Firebase connection...</span>';
            
            try {
                await db.collection('test').add({ test: true, timestamp: new Date() });
                result.innerHTML = '<span class="success">‚úÖ Firebase connection successful!</span>';
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Firebase connection failed: ${error.message}</span>`;
            }
        }
        
        async function testProductLoad() {
            const result = document.getElementById('products-result');
            result.innerHTML = '<span class="pending">Loading products from admin panel...</span>';
            
            try {
                const snapshot = await db.collection('products').get();
                const productCount = snapshot.size;
                
                if (productCount === 0) {
                    result.innerHTML = '<span class="error">‚ùå No products found. Add products in admin panel first.</span>';
                } else {
                    let productList = '<span class="success">‚úÖ Products loaded successfully!</span><br><br>';
                    snapshot.forEach(doc => {
                        const product = doc.data();
                        productList += `<strong>${product.name}</strong> - ${product.category} - Stock: ${product.stock || 0}<br>`;
                    });
                    result.innerHTML = productList;
                }
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Error loading products: ${error.message}</span>`;
            }
        }
        
        async function addSampleProduct() {
            const result = document.getElementById('add-result');
            result.innerHTML = '<span class="pending">Adding sample product...</span>';
            
            try {
                const sampleProduct = {
                    name: "Test Integration Product",
                    category: "capital",
                    description: "This is a test product to verify integration",
                    price: 10000,
                    stock: 5,
                    status: "active",
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('products').add(sampleProduct);
                result.innerHTML = '<span class="success">‚úÖ Sample product added successfully! Check admin panel and website.</span>';
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Error adding product: ${error.message}</span>`;
            }
        }
        
        function testCategoryMapping() {
            const result = document.getElementById('category-result');
            
            const categoryMap = {
                'capital': 'construction',
                'holdings': 'investment', 
                'inter-africa': 'financial',
                'other': 'consulting'
            };
            
            let mappingDisplay = '<span class="success">‚úÖ Category mapping configured:</span><br><br>';
            Object.entries(categoryMap).forEach(([admin, website]) => {
                mappingDisplay += `Admin "${admin}" ‚Üí Website "${website}"<br>`;
            });
            
            result.innerHTML = mappingDisplay;
        }
    </script>
</body>
</html>